<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Japan Trip 2026 ğŸ‡¯ğŸ‡µ</title>
    
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/japan.png">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/japan.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        candy: {
                            bg: '#F0F8FF',      /* [ä¿®æ”¹] å¾ç²‰è‰²æ”¹ç‚ºå†°è—è‰² (AliceBlue) */
                            pink: '#FF9AA2',    
                            blue: '#A0C4FF',    
                            mint: '#B5EAD7',    
                            purple: '#D5AAFF',  
                            yellow: '#FDFFB6',  
                            red: '#FF6B6B',     
                            dark: '#4A405F',    
                            gray: '#B8B8AA'     
                        }
                    },
                    borderRadius: { '4xl': '2.5rem' },
                    fontFamily: {
                        'sans': ['"Varela Round"', '"Noto Sans TC"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        html, body {
            height: 100%;
            overflow-x: hidden; 
        }
        body { 
            /* [ä¿®æ”¹] èƒŒæ™¯åº•è‰²æ”¹ç‚ºå†°å†·å†¬æ—¥è— */
            background-color: #F0F8FF; 
            color: #4A405F;
            
            /* [ä¿®æ”¹] èƒŒæ™¯åœ–æ¡ˆæ”¹ç‚ºä¸‹é›ªæ•ˆæœ */
            background-image: 
                /* ç¬¬ä¸€å±¤ï¼šè¼ƒå¤§ã€è¼ƒäº®çš„é›ªèŠ± */
                radial-gradient(rgba(255, 255, 255, 0.9) 2px, transparent 2.5px),
                /* ç¬¬äºŒå±¤ï¼šè¼ƒå°ã€è¼ƒé çš„åŠé€æ˜é›ªèŠ± */
                radial-gradient(rgba(255, 255, 255, 0.5) 1.5px, transparent 2px);
                
            /* èª¿æ•´é›ªèŠ±çš„å¤§å°é–“è· */
            background-size: 40px 40px, 30px 30px;
            /* éŒ¯é–‹å…©å±¤é›ªèŠ±çš„ä½ç½® */
            background-position: 0 0, 20px 20px;
            
            padding-bottom: 0;
        }
        body::after {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            /* [ä¿®æ”¹] é®ç½©å±¤æ”¹ç‚ºåŠé€æ˜çš„å†°è—è‰²ï¼Œè®“é›ªèŠ±çœ‹èµ·ä¾†æ›´æŸ”å’Œ */
            background: rgba(240, 248, 255, 0.85);
            z-index: -1;
            /* åŠ å…¥ä¸€é»æ¨¡ç³Šæ¿¾é¡å¢åŠ ç©ºæ°£æ„Ÿ (åŠ ä¸Š -webkit- ä»¥æ”¯æ´æ›´å¤šç€è¦½å™¨) */
            -webkit-backdrop-filter: blur(1px);
            backdrop-filter: blur(1px);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; } 
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .card-sticker {
            background-color: #FFFFFF;
            border-radius: 1.5rem;
            /* [å¾®èª¿] é™°å½±é¡è‰²ç¨å¾®èª¿å†·ä¸€é»ï¼Œé…åˆå†¬æ—¥æ°£æ°› */
            box-shadow: 4px 4px 0px rgba(160, 196, 255, 0.15), 0 2px 5px rgba(0,0,0,0.05);
            border: 3px solid #FFF;
            transition: transform 0.2s;
        }
/* [ä¿®æ”¹] å¡ç‰‡åŸºç¤æ¨£å¼ */
        .card-sticker {
            background-color: #FFFFFF;
            border-radius: 1.5rem;
            /* é™°å½±æ”¹ç‚ºå†·è‰²èª¿ */
            box-shadow: 4px 4px 0px rgba(160, 196, 255, 0.2), 0 2px 5px rgba(0,0,0,0.05);
            border: 3px solid #FFF;
            transition: transform 0.2s;
        }

        /* [ä¿®æ”¹] æ—¥æœŸé¸æ“‡å¡ç‰‡ (Day Selector) */
        .nav-card { 
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); 
            transform: scale(0.95); 
            border-radius: 1.25rem; 
            background: white; 
            /* æœªé¸å–æ™‚æ˜¯æ·¡æ·¡çš„è—è‰²é‚Šæ¡† */
            border: 2px solid #F0F8FF; 
        } 
        .nav-card.active { 
            transform: scale(1.05) translateY(-5px); 
            background-color: #FFF; 
            /* [é‡é»] é¸å–æ™‚è®Šæˆ å†°è—è‰²é‚Šæ¡† */
            border-color: #A0C4FF; 
            /* [é‡é»] æ–‡å­—è®Šæ·±è—è‰² */
            color: #3B82F6; 
            /* [é‡é»] é™°å½±è®Šè—è‰²å…‰æšˆ */
            box-shadow: 0 8px 15px -3px rgba(160, 196, 255, 0.6); 
        }
        .nav-card.active span.day-label { 
            /* æ—¥æœŸæ–‡å­—è®Šè—è‰² */
            color: #3B82F6; 
            font-weight: 900; 
            font-size: 1.4rem; 
        } 
        .page-section { display: none; animation: popUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); } 
        .page-section.active { display: block; } 
        @keyframes popUp { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        
        .timeline-item { position: relative; padding-left: 3.8rem; border-left: 4px dashed #E5E7EB; padding-bottom: 2.5rem; } 
        .timeline-item:last-child { border-left: none; padding-bottom: 0; }
        
        .time-bubble {
            position: absolute; left: -1.2rem; top: -0.2rem;
            background: #FFF;
            border: 2px solid #FF9AA2;
            color: #FF6B6B;
            font-size: 0.75rem;
            font-weight: 800;
            padding: 0.3rem 0.6rem;
            border-radius: 1rem;
            box-shadow: 2px 2px 0 #FF9AA2;
            z-index: 5;
            min-width: 3.5rem;
            text-align: center;
        }
    
        .transit-info { 
            background: #F0F9FF; 
            border-radius: 1.5rem; padding: 1rem; 
            border: 2px dashed #A0C4FF; 
            display: flex; align-items: center; margin-bottom: 1.5rem; 
            box-shadow: 4px 4px 0 #A0C4FF; 
            transform: rotate(-1deg);
        }
        
        .map-link { color: #FF9AA2; border-bottom: 3px dotted #FF9AA2; font-weight: 800; transition: all 0.2s; }
        .map-link:hover { color: #FF6B6B; border-bottom-style: solid; }
        
    /* [ä¿®æ”¹] åº•éƒ¨å°è¦½åˆ— (Bottom Nav) */
        .bottom-nav-item { color: #C4C4C4; transition: all 0.3s; }
        .bottom-nav-item.active { 
            /* é¸å–æ™‚æ–‡å­—è®Šæ·±è—è‰² */
            color: #4A405F; 
            transform: translateY(-8px); 
        }
        .bottom-nav-item.active .icon-box { 
            /* [é‡é»] åœ–ç¤ºèƒŒæ™¯æ”¹æˆ è—è‰²æ¼¸å±¤ (Blue to Mint) */
            background: linear-gradient(135deg, #A0C4FF 0%, #B5EAD7 100%); 
            color: white; 
            /* é™°å½±æ”¹ç‚ºè—è‰² */
            box-shadow: 0 6px 15px rgba(160, 196, 255, 0.6); 
            transform: scale(1.2) rotate(-5deg);
        }
        
        .check-item { transition: all 0.3s; border: 2px solid #F5F5F5; background-color: #FFF; border-radius: 1.2rem; margin-bottom: 0.8rem; }
        .check-item:active { transform: scale(0.98); }
        .check-item.checked { opacity: 0.6; background-color: #FAFAFA; border-color: transparent; }
        .check-item.checked span { text-decoration: line-through; color: #CCC; }
        .check-item i.fa-check-circle { display: none; }
        .check-item.checked i.fa-check-circle { display: inline-block; color: #B5EAD7; font-size: 1.4rem; }
        .check-item.checked i.fa-circle { display: none; }
    
        input { border: 2px solid #EEE; transition: all 0.3s; border-radius: 1rem; }
        input:focus { border-color: #FF9AA2; box-shadow: 0 0 0 4px rgba(255, 154, 162, 0.3); outline: none; }
    
        details > summary { list-style: none; cursor: pointer; outline: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: sweep .3s ease-in-out; }
        @keyframes sweep { 0% {opacity: 0; transform: translateY(-10px)} 100% {opacity: 1; transform: translateY(0)} }
    
        #flash-card-modal { transition: opacity 0.3s ease; }
        #flash-card-modal.hidden { pointer-events: none; opacity: 0; }
        
        padding-top: env(safe-area-inset-top); 
        body { padding-bottom: calc(12rem + env(safe-area-inset-bottom)); }
    </style>
</head>
<body class="min-h-screen">

    <div id="top-header" class="bg-white/80 backdrop-blur-md pt-4 pb-2 sticky top-0 z-40 shadow-sm border-b-4 border-blue-200 rounded-b-[2.5rem]" style="padding-top: max(1rem, env(safe-area-inset-top));">
        <h1 class="relative text-center text-2xl font-black text-candy-dark mb-4 tracking-widest flex justify-center items-center drop-shadow-sm">
            <span class="bg-white text-red-500 w-10 h-10 rounded-full flex items-center justify-center mr-2 shadow-md transform -rotate-12 text-lg border-2 border-red-100">
                <i class="fas fa-torii-gate"></i>
            </span>
            JAPAN <span class="text-blue-400 mx-1 font-mono">2026</span>
            </h1>
        
        <div id="day-selector" class="relative flex overflow-x-auto no-scrollbar gap-3 px-4 pb-2 md:justify-center transition-all duration-300">
            <button onclick="switchDay('day1', this)" data-day="day1" class="nav-card active flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center"><span class="text-[10px] font-bold text-gray-400 mb-1">1/23</span><span class="font-black text-xl day-label">Fri</span></button>
            <button onclick="switchDay('day2', this)" data-day="day2" class="nav-card flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center"><span class="text-[10px] font-bold text-gray-400 mb-1">1/24</span><span class="font-black text-xl day-label">Sat</span></button>
            <button onclick="switchDay('day3', this)" data-day="day3" class="nav-card flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center"><span class="text-[10px] font-bold text-gray-400 mb-1">1/25</span><span class="font-black text-xl day-label">Sun</span></button>
            <button onclick="switchDay('day4', this)" data-day="day4" class="nav-card flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center"><span class="text-[10px] font-bold text-gray-400 mb-1">1/26</span><span class="font-black text-xl day-label">Mon</span></button>
            <button onclick="switchDay('day5', this)" data-day="day5" class="nav-card flex-shrink-0 w-16 h-20 flex flex-col items-center justify-center"><span class="text-[10px] font-bold text-gray-400 mb-1">1/27</span><span class="font-black text-xl day-label">Tue</span></button>
        </div>
    </div>

    <div class="p-4 md:p-6 max-w-2xl mx-auto min-h-[60vh]">
        
        <div id="page-day1" class="page-section active space-y-5">
            <div id="weather-card-day1" class="card-sticker p-4 bg-gradient-to-r from-pink-50 to-white flex justify-between items-center relative overflow-hidden">
                <div class="flex items-center z-10"><span class="text-4xl mr-4" id="weather-icon-day1">ğŸŒ¤ï¸</span><div><p class="font-black text-gray-700 text-lg">Day 1 é å ±</p><p class="text-xs text-gray-500 font-bold" id="weather-text-day1">è¼‰å…¥ä¸­...</p><div class="bg-pink-100 text-pink-600 text-[10px] font-bold px-2 py-1 rounded-lg mt-1 inline-block" id="weather-advice-day1"></div></div></div>
                <i class="fas fa-mountain absolute -right-6 -bottom-6 text-9xl text-pink-100 opacity-60"></i>
            </div>
            <div id="container-day1" class="card-sticker p-6 relative overflow-hidden bg-white/90"></div>
        </div>
        <div id="page-day2" class="page-section space-y-5"><div id="weather-card-day2" class="card-sticker p-4 bg-gradient-to-r from-blue-50 to-white flex justify-between items-center relative"><div class="flex items-center z-10"><span class="text-4xl mr-4" id="weather-icon-day2">ğŸŒ¤ï¸</span><div><p class="font-black text-gray-700 text-lg">Day 2 é å ±</p><p class="text-xs text-gray-500 font-bold" id="weather-text-day2">...</p><div class="bg-blue-100 text-blue-600 text-[10px] font-bold px-2 py-1 rounded-lg mt-1 inline-block" id="weather-advice-day2"></div></div></div></div><div id="container-day2" class="card-sticker p-6 relative bg-white/90"></div></div>
        <div id="page-day3" class="page-section space-y-5"><div id="weather-card-day3" class="card-sticker p-4 bg-gradient-to-r from-green-50 to-white flex justify-between items-center relative"><div class="flex items-center z-10"><span class="text-4xl mr-4" id="weather-icon-day3">ğŸŒ¤ï¸</span><div><p class="font-black text-gray-700 text-lg">Day 3 é å ±</p><p class="text-xs text-gray-500 font-bold" id="weather-text-day3">...</p><div class="bg-green-100 text-green-600 text-[10px] font-bold px-2 py-1 rounded-lg mt-1 inline-block" id="weather-advice-day3"></div></div></div></div><div id="container-day3" class="card-sticker p-6 relative bg-white/90"></div></div>
        <div id="page-day4" class="page-section space-y-5"><div id="weather-card-day4" class="card-sticker p-4 bg-gradient-to-r from-yellow-50 to-white flex justify-between items-center relative"><div class="flex items-center z-10"><span class="text-4xl mr-4" id="weather-icon-day4">ğŸŒ¤ï¸</span><div><p class="font-black text-gray-700 text-lg">Day 4 é å ±</p><p class="text-xs text-gray-500 font-bold" id="weather-text-day4">...</p><div class="bg-yellow-100 text-yellow-600 text-[10px] font-bold px-2 py-1 rounded-lg mt-1 inline-block" id="weather-advice-day4"></div></div></div></div><div id="container-day4" class="card-sticker p-6 relative bg-white/90"></div></div>
        <div id="page-day5" class="page-section space-y-5"><div id="weather-card-day5" class="card-sticker p-4 bg-gradient-to-r from-purple-50 to-white flex justify-between items-center relative"><div class="flex items-center z-10"><span class="text-4xl mr-4" id="weather-icon-day5">ğŸŒ¤ï¸</span><div><p class="font-black text-gray-700 text-lg">Day 5 é å ±</p><p class="text-xs text-gray-500 font-bold" id="weather-text-day5">...</p><div class="bg-purple-100 text-purple-600 text-[10px] font-bold px-2 py-1 rounded-lg mt-1 inline-block" id="weather-advice-day5"></div></div></div></div><div id="container-day5" class="card-sticker p-6 relative bg-white/90"></div></div>

        <div id="page-notes" class="page-section space-y-5">
    
            <div class="card-sticker p-6 bg-white/95 border-l-4 border-l-blue-400 relative overflow-hidden">
                <div class="absolute right-0 top-0 opacity-10 text-9xl text-blue-500 -mr-4 -mt-4 rotate-12"><i class="fas fa-plane-departure"></i></div>
                <h2 class="text-2xl font-black text-candy-dark mb-6 flex items-center"><span class="bg-blue-100 w-12 h-12 flex items-center justify-center rounded-full mr-3 text-blue-500 shadow-sm"><i class="fas fa-ticket-alt"></i></span>èˆªç­èˆ‡äº¤é€š</h2>
                
                <div class="mb-4 bg-blue-50/50 rounded-2xl p-4 border border-blue-100">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-blue-500 text-white text-[10px] font-black px-2 py-1 rounded">å»ç¨‹ 1/23 (äº”)</span>
                        <span class="text-blue-400 font-black text-lg">CI 104</span>
                    </div>
                    <div class="flex justify-between items-center text-gray-700 font-bold mb-3">
                        <div class="text-center"><span class="block text-2xl font-black">12:35</span><span class="text-xs text-gray-400">TPE æ¡ƒåœ’</span></div>
                        <i class="fas fa-arrow-right text-blue-200"></i>
                        <div class="text-center"><span class="block text-2xl font-black">16:35</span><span class="text-xs text-gray-400">NRT æˆç”°</span></div>
                    </div>
                    <div class="bg-white p-3 rounded-xl border border-blue-100 flex items-start">
                        <div class="bg-yellow-400 text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mr-3 text-xs font-black shadow-sm"><i class="fas fa-bus"></i></div>
                        <div>
                            <p class="text-sm font-black text-gray-700">1962 å¤§æœ‰å·´å£«</p>
                            <p class="text-xs text-gray-500 font-bold mt-1"><i class="fas fa-map-marker-alt mr-1 text-red-400"></i>å¤§åŒèŠåœ’ (08:00 ç™¼è»Š)</p>
                        </div>
                    </div>
                </div>
        
                <div class="bg-pink-50/50 rounded-2xl p-4 border border-pink-100">
                    <div class="flex justify-between items-center mb-2">
                        <span class="bg-pink-400 text-white text-[10px] font-black px-2 py-1 rounded">å›ç¨‹ 1/27 (äºŒ)</span>
                        <span class="text-pink-400 font-black text-lg">CI 109</span>
                    </div>
                    <div class="flex justify-between items-center text-gray-700 font-bold mb-3">
                        <div class="text-center"><span class="block text-2xl font-black">19:30</span><span class="text-xs text-gray-400">NRT æˆç”°</span></div>
                        <i class="fas fa-arrow-right text-pink-200"></i>
                        <div class="text-center"><span class="block text-2xl font-black">22:45</span><span class="text-xs text-gray-400">TPE æ¡ƒåœ’</span></div>
                    </div>
                    <div class="bg-white p-3 rounded-xl border border-pink-100 flex items-start">
                        <div class="bg-purple-400 text-white w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 mr-3 text-xs font-black shadow-sm"><i class="fas fa-car"></i></div>
                        <div>
                            <p class="text-sm font-black text-gray-700">é ç´„æ¥é€</p>
                            <p class="text-xs text-red-500 font-bold mt-1 bg-red-50 px-2 py-0.5 rounded inline-block"><i class="fas fa-coins mr-1"></i>è»Šä¸Šä»˜ $1000 ç¾é‡‘</p>
                        </div>
                    </div>
                </div>
            </div>
        
            <div class="card-sticker p-5 bg-gradient-to-br from-red-50 to-white border-l-4 border-l-red-400 relative overflow-hidden">
                <div class="absolute right-0 top-0 opacity-10 text-9xl text-red-500 -mr-4 -mt-4 rotate-12"><i class="fas fa-qrcode"></i></div>
                <h3 class="text-lg font-black text-red-600 mb-2 flex items-center"><i class="fas fa-passport mr-2"></i>å…¥å¢ƒæ‰‹çºŒ Visit Japan Web</h3>
                <div class="text-sm text-gray-600 font-bold leading-relaxed relative z-10">
                    <p class="mb-2">è«‹ç¢ºä¿åœ¨å‡ºç™¼å‰å®Œæˆ <span class="text-red-500 bg-red-100 px-1 rounded">Visit Japan Web</span> å¡«å¯«ã€‚</p>
                    <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" class="mt-2 block text-center bg-red-500 text-white py-2 rounded-lg text-xs font-black shadow-sm">å‰å¾€ç¶²ç«™</a>
                </div>
            </div>
        
            <div class="card-sticker p-6 bg-white/95">
                <h2 class="text-2xl font-black text-candy-dark mb-6 flex items-center"><span class="bg-pink-100 w-12 h-12 flex items-center justify-center rounded-full mr-3 text-pink-500 shadow-sm"><i class="fas fa-language fa-bounce"></i></span>ç”Ÿå­˜æ—¥èª</h2>
                <div class="space-y-4">
                    <details class="group bg-white border-2 border-orange-100 rounded-2xl overflow-hidden shadow-sm open:shadow-md transition-all">
                        <summary class="flex items-center justify-between p-4 cursor-pointer bg-orange-50/50 hover:bg-orange-50 transition">
                            <div class="flex items-center"><span class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-orange-400 shadow-sm mr-3 text-lg"><i class="fas fa-utensils"></i></span><span class="font-black text-gray-700">é¤å»³é»é¤</span></div>
                            <i class="fas fa-chevron-down text-orange-300 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="p-4 pt-2 border-t border-orange-100 bg-white grid grid-cols-2 gap-3">
                            <button onclick="showFlashCard('è«‹çµ¦æˆ‘èœå–®', 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™')" class="bg-gray-50 hover:bg-orange-100 border border-gray-100 p-3 rounded-xl text-left transition group/btn"><span class="block text-xs text-gray-400 mb-1">è«‹çµ¦æˆ‘èœå–®</span><span class="block text-sm font-black text-gray-700 group-hover/btn:text-orange-500">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’...</span></button>
                            <button onclick="showFlashCard('æˆ‘è¦é»é€™å€‹', 'ã“ã‚Œã‚’ãã ã•ã„')" class="bg-gray-50 hover:bg-orange-100 border border-gray-100 p-3 rounded-xl text-left transition group/btn"><span class="block text-xs text-gray-400 mb-1">æˆ‘è¦é»é€™å€‹</span><span class="block text-sm font-black text-gray-700 group-hover/btn:text-orange-500">ã“ã‚Œã‚’...</span></button>
                            <button onclick="showFlashCard('è«‹çµ¦æˆ‘æ°´', 'ãŠæ°´ã‚’ãŠé¡˜ã„ã—ã¾ã™')" class="bg-gray-50 hover:bg-orange-100 border border-gray-100 p-3 rounded-xl text-left transition group/btn"><span class="block text-xs text-gray-400 mb-1">è«‹çµ¦æˆ‘æ°´</span><span class="block text-sm font-black text-gray-700 group-hover/btn:text-orange-500">ãŠæ°´ã‚’...</span></button>
                            <button onclick="showFlashCard('æˆ‘è¦çµå¸³', 'ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™')" class="bg-gray-50 hover:bg-orange-100 border border-gray-100 p-3 rounded-xl text-left transition group/btn"><span class="block text-xs text-gray-400 mb-1">æˆ‘è¦çµå¸³</span><span class="block text-sm font-black text-gray-700 group-hover/btn:text-orange-500">ãŠä¼šè¨ˆã‚’...</span></button>
                        </div>
                    </details>
                    <details class="group bg-white border-2 border-blue-100 rounded-2xl overflow-hidden shadow-sm open:shadow-md transition-all">
                        <summary class="flex items-center justify-between p-4 cursor-pointer bg-blue-50/50 hover:bg-blue-50 transition">
                            <div class="flex items-center"><span class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-blue-400 shadow-sm mr-3 text-lg"><i class="fas fa-shopping-bag"></i></span><span class="font-black text-gray-700">è³¼ç‰© & äº¤é€š</span></div>
                            <i class="fas fa-chevron-down text-blue-300 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="p-4 pt-2 border-t border-blue-100 bg-white grid grid-cols-2 gap-3">
                            <button onclick="showFlashCard('å¯ä»¥åˆ·å¡å—?', 'ã‚«ãƒ¼ãƒ‰ã¯ä½¿ãˆã¾ã™ã‹ï¼Ÿ')" class="bg-gray-50 hover:bg-blue-100 border border-gray-100 p-3 rounded-xl text-left transition group/btn"><span class="block text-xs text-gray-400 mb-1">å¯ä»¥åˆ·å¡å—?</span><span class="block text-sm font-black text-gray-700 group-hover/btn:text-blue-500">ã‚«ãƒ¼ãƒ‰...</span></button>
                            <button onclick="showFlashCard('æœ‰å…ç¨…å—?', 'å…ç¨ã¯ã§ãã¾ã™ã‹ï¼Ÿ')" class="bg-gray-50 hover:bg-blue-100 border border-gray-100 p-3 rounded-xl text-left transition group/btn"><span class="block text-xs text-gray-400 mb-1">æœ‰å…ç¨…å—?</span><span class="block text-sm font-black text-gray-700 group-hover/btn:text-blue-500">å…ç¨ã¯...</span></button>
                            <button onclick="showFlashCard('è«‹è¼‰æˆ‘å»é€™è£¡', 'ã“ã“ã¾ã§ãŠé¡˜ã„ã—ã¾ã™')" class="col-span-2 bg-yellow-50 hover:bg-yellow-100 border border-yellow-100 p-3 rounded-xl text-center transition group/btn"><span class="block text-xs text-gray-400 mb-1"><i class="fas fa-taxi mr-1"></i>çµ¦å¸æ©Ÿçœ‹</span><span class="block text-lg font-black text-gray-800 group-hover/btn:text-yellow-600">è«‹è¼‰æˆ‘å»é€™è£¡</span></button>
                        </div>
                    </details>
                </div>
            </div>
        
            <div class="card-sticker p-6 bg-white/95">
                <h2 class="text-2xl font-black text-candy-dark mb-6 flex items-center"><span class="bg-candy-yellow w-12 h-12 flex items-center justify-center rounded-full mr-3 text-orange-500 shadow-sm"><i class="fas fa-bed"></i></span>ä½å®¿è³‡è¨Š</h2>
                <div class="space-y-4">
                    <details class="group bg-white border-2 border-candy-blue rounded-2xl overflow-hidden shadow-sm open:shadow-md transition-all" open>
                        <summary class="flex items-center justify-between p-4 cursor-pointer bg-blue-50/50 hover:bg-blue-50 transition">
                            <div class="flex items-center"><span class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-blue-400 shadow-sm mr-3 text-lg"><i class="fas fa-hotel"></i></span><div><h3 class="font-black text-gray-700 text-sm">Super Hotel æ± è¢‹è¥¿å£</h3><span class="text-[10px] text-gray-400 font-bold">Ikebukuro Nishiguchi</span></div></div>
                            <i class="fas fa-chevron-down text-blue-300 group-open:rotate-180 transition-transform"></i>
                        </summary>
                        <div class="p-4 pt-0 border-t border-blue-100 bg-white">
                            <div class="flex gap-2 my-3">
                                <a href="https://www.google.com/maps/search/?api=1&query=Super+Hotel+Ikebukuro+Nishiguchi" target="_blank" class="flex-1 bg-green-500 text-white py-2 rounded-xl text-xs font-black text-center shadow-sm hover:bg-green-600 transition flex items-center justify-center"><i class="fas fa-map-marked-alt mr-1"></i> åœ°åœ–</a>
                                <button onclick="copyText('æ±äº¬éƒ½è±Šå³¶åŒºæ± è¢‹2-14-1')" class="flex-1 bg-gray-100 text-gray-600 py-2 rounded-xl text-xs font-black hover:bg-gray-200 transition"><i class="fas fa-copy mr-1"></i> è¤‡è£½åœ°å€</button>
                                <button onclick="showTaxiCard('Super Hotel æ± è¢‹è¥¿å£', 'æ±äº¬éƒ½è±Šå³¶åŒºæ± è¢‹2-14-1')" class="flex-1 bg-yellow-400 text-white py-2 rounded-xl text-xs font-black hover:bg-yellow-500 transition shadow-sm"><i class="fas fa-taxi mr-1"></i> æ‰¾è»Š</button>
                            </div>
                            <div class="text-xs text-gray-500 space-y-2 font-bold bg-gray-50 p-3 rounded-xl">
                                <p><i class="fas fa-map-pin mr-2 text-blue-400 w-4"></i> æ±äº¬éƒ½è±Šå³¶åŒºæ± è¢‹2-14-1</p>
                                <p><i class="fas fa-phone mr-2 text-blue-400 w-4"></i> 03-5911-9000</p>
                                <p><i class="fas fa-info-circle mr-2 text-blue-400 w-4"></i> é è¿‘æ± è¢‹ç«™ C1 æˆ– C6 å‡ºå£ (æœ‰é›»æ¢¯)</p>
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        
            <div class="card-sticker p-6 bg-red-50 border-2 border-red-100 relative overflow-hidden">
                <h2 class="text-xl font-black text-red-600 mb-4 flex items-center"><i class="fas fa-exclamation-triangle mr-2"></i> ç·Šæ€¥æ•‘æ´</h2>
                <div class="grid grid-cols-3 gap-3">
                    <a href="tel:110" class="bg-white border border-red-200 p-3 rounded-xl flex flex-col items-center justify-center hover:bg-red-600 hover:text-white transition group shadow-sm"><i class="fas fa-user-shield text-2xl text-red-500 mb-1 group-hover:text-white"></i><span class="text-xs font-black">è­¦å¯Ÿ 110</span></a>
                    <a href="tel:119" class="bg-white border border-red-200 p-3 rounded-xl flex flex-col items-center justify-center hover:bg-red-600 hover:text-white transition group shadow-sm"><i class="fas fa-ambulance text-2xl text-red-500 mb-1 group-hover:text-white"></i><span class="text-xs font-black">æ•‘è­· 119</span></a>
                    <a href="tel:+81332807111" class="bg-white border border-red-200 p-3 rounded-xl flex flex-col items-center justify-center hover:bg-red-600 hover:text-white transition group shadow-sm"><i class="fas fa-phone-volume text-2xl text-red-500 mb-1 group-hover:text-white"></i><span class="text-xs font-black">é§æ—¥ä»£è¡¨</span></a>
                </div>
            </div>
        </div>

        <div id="page-checklist" class="page-section space-y-5">
            <div class="card-sticker p-6 bg-white/95">
                <h2 class="text-2xl font-black text-candy-dark mb-6 flex items-center"><span class="bg-candy-mint w-12 h-12 flex items-center justify-center rounded-full mr-3 text-green-600 shadow-sm"><i class="fas fa-backpack fa-bounce"></i></span>å¿…å‚™æ¸…å–®</h2>
                <div class="flex gap-2 mb-6 p-1 bg-white rounded-2xl border-2 border-candy-mint shadow-sm">
                    <input type="text" id="new-item-input" placeholder="é‚„æœ‰ä»€éº¼è¦å¸¶çš„ï¼Ÿ" class="flex-1 p-3 bg-transparent border-none text-sm font-bold text-gray-700 focus:ring-0">
                    <button onclick="addCustomItem()" class="bg-candy-mint text-green-700 w-10 h-10 rounded-xl flex items-center justify-center hover:bg-green-200 transition shadow-md m-1"><i class="fas fa-plus"></i></button>
                </div>
                <div class="mb-3 flex items-center"><span class="bg-candy-blue text-blue-600 text-[10px] font-black px-2 py-1 rounded mr-2">PUBLIC</span> <span class="text-xs font-bold text-gray-400">å¤§å®¶éƒ½è¦å¸¶ (Excel)</span></div>
                <div id="checklist-excel-container" class="space-y-2 mb-6"></div>
                <div class="mb-3 flex items-center justify-between"><div class="flex items-center"><span class="bg-candy-purple text-purple-600 text-[10px] font-black px-2 py-1 rounded mr-2">PRIVATE</span> <span class="text-xs font-bold text-gray-400">æˆ‘çš„å°ˆå±¬</span></div><i class="fas fa-lock text-gray-300 text-xs"></i></div>
                <div id="checklist-custom-container" class="space-y-2"></div>
                <div class="flex justify-center mt-8">
                    <button onclick="resetChecklist()" class="text-xs text-gray-400 font-bold hover:text-red-400 transition bg-gray-50 px-4 py-2 rounded-full border border-gray-200"><i class="fas fa-trash-restore mr-1"></i> é‡ç½®æ‰“å‹¾</button>
                </div>
            </div>
        </div>

        <div id="page-finance" class="page-section space-y-5">
            <div class="card-sticker p-6 bg-white/95">
                <h2 class="text-2xl font-black text-candy-dark mb-6 flex items-center"><span class="bg-candy-yellow w-12 h-12 flex items-center justify-center rounded-full mr-3 text-orange-500 shadow-sm"><i class="fas fa-piggy-bank fa-bounce"></i></span>è¨˜å¸³å°å¹«æ‰‹</h2>
                <form id="expense-form" class="space-y-5 font-bold">
                    
                    <div>
                        <label class="block text-xs text-gray-400 mb-1 pl-1 uppercase tracking-wider font-black">Item Name</label>
                        <div class="relative">
                            <i class="fas fa-tag absolute left-4 top-1/2 -translate-y-1/2 text-gray-300"></i>
                            <input type="text" id="item" placeholder="æ¨™é¡Œ (ä¾‹: è—¥å¦åº—)" class="w-full p-4 pl-10 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-candy-yellow transition text-gray-700" required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-gray-400 mb-1 pl-1 uppercase tracking-wider font-black">Note</label>
                        <div class="relative">
                            <i class="fas fa-sticky-note absolute left-4 top-1/2 -translate-y-1/2 text-gray-300"></i>
                            <input type="text" id="note" placeholder="å‚™è¨» (ä¾‹: çœ¼è—¥æ°´ã€æ„Ÿå†’è—¥...)" class="w-full p-4 pl-10 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-candy-yellow transition text-gray-700">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-gray-400 mb-1 pl-1 uppercase tracking-wider font-black">Amount (JPY)</label>
                        <div class="relative">
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-300 font-black">Â¥</span>
                            <input type="number" id="cost" placeholder="0" class="w-full p-4 pl-10 bg-gray-50 border-2 border-gray-100 rounded-2xl focus:border-candy-yellow text-xl font-black text-gray-700" required oninput="updateExpensePreview()">
                        </div>
                        <div id="expense-twd-preview" class="text-xs text-orange-500 font-bold mt-2 ml-1 hidden bg-candy-yellow/30 inline-block px-3 py-1 rounded-full border border-candy-yellow">
                            <i class="fas fa-equals mr-1"></i> å°å¹£ç´„ <span id="preview-amount">0</span> å…ƒ
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs text-gray-400 mb-2 pl-1 uppercase tracking-wider font-black">Paid By</label>
                        <div class="grid grid-cols-3 gap-3">
                            <label class="cursor-pointer relative group"><input type="radio" name="payer" value="Honnie" class="peer sr-only" required><div class="p-3 text-center bg-gray-50 border-2 border-gray-100 rounded-2xl peer-checked:bg-candy-yellow peer-checked:border-orange-200 peer-checked:text-orange-600 transition text-gray-400 font-black group-hover:bg-white group-hover:shadow-sm"><div class="mb-1"><i class="fas fa-user-circle text-lg"></i></div>Honnie</div></label>
                            <label class="cursor-pointer relative group"><input type="radio" name="payer" value="Emily" class="peer sr-only"><div class="p-3 text-center bg-gray-50 border-2 border-gray-100 rounded-2xl peer-checked:bg-candy-pink peer-checked:border-pink-200 peer-checked:text-pink-600 transition text-gray-400 font-black group-hover:bg-white group-hover:shadow-sm"><div class="mb-1"><i class="fas fa-user-circle text-lg"></i></div>Emily</div></label>
                            <label class="cursor-pointer relative group"><input type="radio" name="payer" value="å…¬è²»" class="peer sr-only" checked><div class="p-3 text-center bg-gray-50 border-2 border-gray-100 rounded-2xl peer-checked:bg-candy-blue peer-checked:border-blue-200 peer-checked:text-blue-600 transition text-gray-400 font-black group-hover:bg-white group-hover:shadow-sm"><div class="mb-1"><i class="fas fa-users text-lg"></i></div>å…¬è²»</div></label>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-candy-yellow to-orange-300 text-white p-4 rounded-2xl font-black text-lg hover:shadow-lg hover:scale-[1.02] active:scale-[0.98] transition flex justify-center items-center shadow-md shadow-orange-100"><i class="fas fa-paper-plane mr-2"></i> è¨˜ä¸€ç­†</button>
                </form>
            </div>
            <div id="message-area" class="hidden p-4 rounded-2xl text-center text-sm font-bold transition-all shadow-sm border mt-4"></div>
        </div>

        <div id="page-tools" class="page-section space-y-5">
            <div class="card-sticker p-6 bg-white/95">
                <h2 class="text-2xl font-black text-candy-dark mb-6 flex items-center"><span class="bg-candy-blue w-12 h-12 flex items-center justify-center rounded-full mr-3 text-blue-600 shadow-sm"><i class="fas fa-calculator fa-flip" style="--fa-animation-duration: 3s;"></i></span>åŒ¯ç‡æ›ç®—</h2>
                <div class="bg-white p-6 rounded-[2rem] border-2 border-gray-100 shadow-inner mb-6 relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 w-20 h-20 bg-blue-50 rounded-full blur-xl"></div>
                    <label class="text-xs text-gray-400 font-black block mb-2 text-center uppercase tracking-widest">Exchange Rate</label>
                    <div class="flex items-center justify-center"><span class="text-gray-400 font-bold mr-2">1 TWD â‰ˆ</span><input type="number" id="rate-input" value="4.6" class="w-24 bg-transparent text-center font-black text-3xl text-blue-500 border-b-2 border-blue-200 focus:border-blue-500 focus:outline-none"><span class="text-gray-400 font-bold ml-2">JPY</span></div>
                    <div class="text-center mt-3"><button onclick="fetchLiveRate()" class="text-[10px] bg-gray-100 text-gray-500 px-3 py-1 rounded-full hover:bg-blue-100 hover:text-blue-500 transition font-bold"><i class="fas fa-sync-alt mr-1" id="rate-loading"></i> æ›´æ–°åŒ¯ç‡</button></div>
                </div>
                <div class="space-y-3">
                    <div class="bg-white p-4 rounded-3xl border-2 border-gray-100 flex items-center shadow-sm group focus-within:border-blue-300 transition"><div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 font-black text-xs mr-3">Â¥</div><div class="flex-1"><label class="text-[10px] text-gray-400 font-bold block">JAPANESE YEN</label><input type="number" id="jp-input" class="w-full bg-transparent text-2xl font-black text-gray-700 focus:outline-none" placeholder="0"></div></div>
                    <div class="flex justify-center text-gray-300"><i class="fas fa-arrow-down fa-bounce"></i></div>
                    <div class="bg-blue-50 p-4 rounded-3xl border-2 border-blue-100 flex items-center shadow-sm"><div class="w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center text-blue-600 font-black text-xs mr-3">NT$</div><div class="flex-1"><label class="text-[10px] text-blue-400 font-bold block">TAIWAN DOLLAR</label><input type="text" id="twd-input" class="w-full bg-transparent text-2xl font-black text-blue-600 focus:outline-none" placeholder="0" readonly></div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="flash-card-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4" onclick="closeFlashCard()">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 text-center relative shadow-2xl transform transition-all scale-100" onclick="event.stopPropagation()">
            <button onclick="closeFlashCard()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-3xl"><i class="fas fa-times-circle"></i></button>
            <div id="flash-card-icon" class="bg-yellow-400 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-white text-4xl shadow-md"><i class="fas fa-comment"></i></div>
            <h3 id="flash-card-title" class="text-lg font-bold text-gray-400 mb-2">æ¨™é¡Œ</h3>
            <div class="bg-gray-50 border-4 border-gray-100 rounded-3xl p-6 mb-6"><p id="flash-card-jp" class="text-3xl font-black text-gray-800 leading-snug break-keep select-all">æ—¥æ–‡å…§å®¹</p></div>
            <p class="text-xs text-gray-400 animate-pulse">è«‹å°‡æ­¤ç•«é¢å‡ºç¤ºçµ¦å°æ–¹çœ‹</p>
        </div>
    </div>
    <div id="taxi-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 text-center relative shadow-2xl transform transition-all scale-100">
            <button onclick="closeTaxiCard()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl"><i class="fas fa-times-circle"></i></button>
            <div class="bg-yellow-400 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-white text-3xl shadow-md"><i class="fas fa-taxi"></i></div>
            <h3 class="text-xl font-black text-gray-800 mb-1">çµ¦å¸æ©Ÿçœ‹</h3>
            <p class="text-xs text-gray-400 font-bold mb-6">Show this to the driver</p>
            <div class="bg-gray-50 border-2 border-gray-100 rounded-2xl p-6 mb-6">
                <p class="text-2xl font-black text-gray-800 mb-4 leading-snug">é‹è»¢æ‰‹ã•ã‚“ã€<br>ã“ã“ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚</p>
                <div class="h-px bg-gray-200 w-1/2 mx-auto mb-4"></div>
                <p id="taxi-dest-name" class="text-sm font-bold text-gray-500 mb-1">ç›®çš„åœ°</p>
                <p id="taxi-dest-addr" class="text-lg font-black text-blue-600 leading-tight select-all">åœ°å€è¼‰å…¥ä¸­...</p>
            </div>
            <button onclick="closeTaxiCard()" class="bg-gray-800 text-white w-full py-4 rounded-xl font-bold hover:bg-black transition">é—œé–‰ Close</button>
        </div>
    </div>

    <nav class="fixed bottom-0 w-full bg-white/90 backdrop-blur-xl border-t border-white/50 pb-[env(safe-area-inset-bottom)] pt-2 z-50 rounded-t-[2rem] shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.1)]">
        <div class="grid grid-cols-5 h-20 max-w-2xl mx-auto px-2">
            <button onclick="switchMainTab('schedule')" id="tab-schedule" class="bottom-nav-item active flex flex-col items-center justify-center group w-full"><div class="icon-box w-12 h-12 rounded-2xl flex items-center justify-center mb-1 transition-all duration-300 bg-transparent text-gray-300 group-hover:text-gray-400"><i class="fas fa-map-marked-alt text-xl"></i></div><span class="text-[9px] font-black tracking-wide">è¡Œç¨‹</span></button>
            <button onclick="switchMainTab('checklist')" id="tab-checklist" class="bottom-nav-item flex flex-col items-center justify-center group w-full"><div class="icon-box w-12 h-12 rounded-2xl flex items-center justify-center mb-1 transition-all duration-300 bg-transparent text-gray-300 group-hover:text-gray-400"><i class="fas fa-check-square text-xl"></i></div><span class="text-[9px] font-black tracking-wide">æ¸…å–®</span></button>
            <button onclick="switchMainTab('notes')" id="tab-notes" class="bottom-nav-item flex flex-col items-center justify-center group w-full"><div class="icon-box w-12 h-12 rounded-2xl flex items-center justify-center mb-1 transition-all duration-300 bg-transparent text-gray-300 group-hover:text-gray-400"><i class="fas fa-info-circle text-xl"></i></div><span class="text-[9px] font-black tracking-wide">è³‡è¨Š</span></button>
            <button onclick="switchMainTab('finance')" id="tab-finance" class="bottom-nav-item flex flex-col items-center justify-center group w-full"><div class="icon-box w-12 h-12 rounded-2xl flex items-center justify-center mb-1 transition-all duration-300 bg-transparent text-gray-300 group-hover:text-gray-400"><i class="fas fa-yen-sign text-xl"></i></div><span class="text-[9px] font-black tracking-wide">è¨˜å¸³</span></button>
            <button onclick="switchMainTab('tools')" id="tab-tools" class="bottom-nav-item flex flex-col items-center justify-center group w-full"><div class="icon-box w-12 h-12 rounded-2xl flex items-center justify-center mb-1 transition-all duration-300 bg-transparent text-gray-300 group-hover:text-gray-400"><i class="fas fa-exchange-alt text-xl"></i></div><span class="text-[9px] font-black tracking-wide">åŒ¯ç‡</span></button>
        </div>
    </nav>

    <div class="h-[300px] w-full pointer-events-none"></div>

    <script>
        let currentDayId = 'day1';
        let currentMainTab = 'schedule';
        // !!! è«‹åœ¨é€™è£¡å¡«å…¥æ‚¨çš„ Google Apps Script URL !!!
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwLXasfAxqCC07PP41f5Pe1fAVJObmDnwe3yQTUfJGRnPsd0h6knHH1F4obd45W4JVh/exec'; 

        function switchMainTab(tabId) {
            currentMainTab = tabId;
            document.querySelectorAll('.bottom-nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            
            const daySelector = document.getElementById('day-selector');
            if (tabId === 'schedule') {
                document.getElementById('page-' + currentDayId).classList.add('active');
                daySelector.classList.remove('hidden', 'opacity-0', 'h-0');
                daySelector.classList.add('flex', 'opacity-100');
            } else {
                document.getElementById('page-' + tabId).classList.add('active');
                daySelector.classList.remove('flex', 'opacity-100');
                daySelector.classList.add('hidden', 'opacity-0', 'h-0');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function switchDay(dayId, btnElement) {
            currentDayId = dayId;
            if (currentMainTab !== 'schedule') switchMainTab('schedule');
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + dayId).classList.add('active');
            document.querySelectorAll('.nav-card').forEach(el => el.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');
            else document.querySelector(`.nav-card[data-day="${dayId}"]`).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Helper Functions for Info Page
        function copyText(text) {
            const tempInput = document.createElement("input");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy"); 
            document.body.removeChild(tempInput);
            alert("å·²è¤‡è£½ï¼š" + text);
        }

        function showFlashCard(title, jpText) {
            document.getElementById('flash-card-title').textContent = title;
            document.getElementById('flash-card-jp').textContent = jpText;
            const iconEl = document.getElementById('flash-card-icon');
            if(title.includes('è»Š') || title.includes('å¸æ©Ÿ')) iconEl.innerHTML = '<i class="fas fa-taxi"></i>';
            else if(title.includes('åƒ') || title.includes('èœå–®') || title.includes('æ°´')) iconEl.innerHTML = '<i class="fas fa-utensils"></i>';
            else if(title.includes('è²·') || title.includes('åˆ·å¡') || title.includes('å…ç¨…')) iconEl.innerHTML = '<i class="fas fa-shopping-bag"></i>';
            else iconEl.innerHTML = '<i class="fas fa-comment"></i>';
            const modal = document.getElementById('flash-card-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
        }
        
        function showTaxiCard(name, addr) {
            document.getElementById('taxi-dest-name').textContent = name;
            document.getElementById('taxi-dest-addr').textContent = addr;
            const modal = document.getElementById('taxi-modal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
        }

        function closeFlashCard() {
            const modal = document.getElementById('flash-card-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        function closeTaxiCard() {
            const modal = document.getElementById('taxi-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }

        // Existing Fetch Data (Itinerary + Checklist)
        function fetchData() {
            if(scriptURL === '' || scriptURL === 'YOUR_NEW_GOOGLE_SCRIPT_URL') {
                document.querySelectorAll('[id^="container-day"]').forEach(el => {
                    el.innerHTML = '<div class="text-center text-gray-400 font-bold py-10">è«‹è¨­å®š Google Script URL</div>';
                });
                renderChecklist([]); 
                return;
            }

            fetch(scriptURL)
            .then(response => response.json())
            .then(data => {
                if(data.itinerary) renderItinerary(data.itinerary);
                if(data.checklist) renderChecklist(data.checklist);
            })
            .catch(err => { console.error('Fetch error:', err); });
        }

        function renderItinerary(data) {
             ['day1', 'day2', 'day3', 'day4', 'day5'].forEach(day => {
                const container = document.getElementById(`container-${day}`);
                if(container) container.innerHTML = '';
            });

            const groupedData = {};
            data.forEach(item => {
                if (!groupedData[item.Day]) groupedData[item.Day] = [];
                groupedData[item.Day].push(item);
            });

            Object.keys(groupedData).forEach(day => {
                const container = document.getElementById(`container-${day}`);
                if(!container) return;
                
                const headerData = groupedData[day].find(i => i.Type === 'header');
                const headerHtml = headerData ? `
                    <h2 class="text-2xl font-black text-candy-dark mb-8 flex items-center pl-2 relative">
                        <span class="absolute -left-1 w-1 h-8 bg-gradient-to-b from-candy-purple to-candy-pink rounded-full"></span>
                        ${headerData.Title}
                        <i class="fas fa-torii-gate text-candy-red ml-2 text-xl absolute -top-4 -left-2 rotate-[-20deg]"></i>
                    </h2>
                ` : '';

                const itemsHtml = groupedData[day]
                    .filter(i => i.Type !== 'header')
                    .map(item => renderItem(item))
                    .join('');

                container.innerHTML = headerHtml + `<div class="">${itemsHtml}</div>`;
            });
        }

        function formatTimeDisplay(val) {
            if (!val) return "";
            const str = val.toString();
            if (str.includes('T') || str.includes('GMT') || str.includes('1899')) {
                const date = new Date(str);
                if (!isNaN(date.getTime())) {
                    let timePart = str.split('T')[1]; 
                    if (timePart) {
                        return timePart.substring(0, 5); 
                    }
                }
            }
            if (str.match(/^\d{1,2}:\d{2}:\d{2}$/)) {
                return str.substring(0, 5);
            }
            return str;
        }

        function renderItem(item) {
            // Google Maps URL Logic
            let mapUrl = item.Link;
            if (!mapUrl && item.Address) {
                mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.Address)}`;
            }

            const linkHtml = mapUrl ? ` <a href="${mapUrl}" target="_blank" class="map-link text-candy-blue hover:text-blue-600 transition"><i class="fas fa-map-marked-alt ml-1 text-xs"></i></a>` : '';
            const addressHtml = item.Address ? `<div class="text-[10px] text-gray-400 font-bold mt-1 flex items-center bg-gray-50 px-2 py-1 rounded-lg w-fit"><i class="fas fa-map-pin mr-1 text-gray-300"></i>${item.Address}</div>` : '';
            const noteHtml = item.Note ? `<div class="bg-gray-50 px-2 py-1 rounded-lg text-[10px] font-bold text-gray-500 mt-2 inline-flex items-center border border-gray-100"><i class="fas fa-sticky-note mr-1 text-candy-yellow"></i>${item.Note}</div>` : '';
            
            const displayTime = formatTimeDisplay(item.Time);

            let iconClass = "bg-gray-200 text-gray-500"; 
            let iconContent = '<i class="fas fa-map-pin"></i>';

            const t = item.Type ? item.Type.toLowerCase().trim() : 'spot';
            if (t === 'transit') {
                return `
                    <div class="transit-info group">
                        <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-lg text-candy-blue shadow-sm mr-3 group-hover:scale-110 transition"><i class="fas fa-train"></i></div>
                        <div class="flex-1">
                            <span class="font-black block text-gray-700 text-sm">${item.Title}</span>
                            <div class="flex justify-between text-xs mt-1 font-bold text-blue-400">
                                <span class="bg-white/60 px-2 py-0.5 rounded-full"><i class="far fa-clock mr-1"></i>${displayTime}</span>
                                <span>${item.Subtitle}</span>
                            </div>
                            ${noteHtml}
                        </div>
                    </div>
                `;
            } else if (t === 'food') {
                iconClass = "bg-orange-100 text-orange-500 border-orange-200";
                iconContent = '<i class="fas fa-utensils"></i>';
            } else if (t === 'shop') {
                iconClass = "bg-candy-blue text-blue-500 border-blue-200";
                iconContent = '<i class="fas fa-shopping-bag"></i>';
            } else if (t === 'stay') {
                iconClass = "bg-candy-purple text-purple-500 border-purple-200";
                iconContent = '<i class="fas fa-bed"></i>';
            } else if (t === 'plane') {
                iconClass = "bg-candy-blue text-blue-500 border-blue-200";
                iconContent = '<i class="fas fa-plane"></i>';
            } else {
                iconClass = "bg-candy-yellow text-orange-500 border-orange-200";
                iconContent = '<i class="fas fa-camera"></i>';
            }

            return `
                <div class="timeline-item">
                    <div class="time-bubble">${displayTime}</div>
                    <div class="timeline-dot ${iconClass} border-2 w-9 h-9 flex items-center justify-center rounded-full shadow-sm text-sm z-10">
                        ${iconContent}
                    </div>
                    <div class="flex flex-col pt-1">
                        <span class="font-black text-base text-gray-700 leading-tight">
                            ${item.Title} ${linkHtml}
                        </span>
                        ${item.Subtitle ? `<span class="text-xs text-gray-400 font-bold mt-0.5">${item.Subtitle}</span>` : ''}
                        ${addressHtml}
                        ${noteHtml}
                    </div>
                </div>
            `;
        }

        // ================= Checklist Logic (Same as before but specific storage key) =================
        function renderChecklist(excelItems) {
            const excelContainer = document.getElementById('checklist-excel-container');
            const customContainer = document.getElementById('checklist-custom-container');
            // Changed storage key for Japan trip to avoid conflict
            const savedChecks = JSON.parse(localStorage.getItem('japanChecklist')) || {};
            const savedCustomItems = JSON.parse(localStorage.getItem('japanCustomItems')) || [];
            
            if (excelItems.length === 0) {
                excelContainer.innerHTML = '<div class="text-center text-gray-300 text-xs py-2">ç„¡ Excel è³‡æ–™</div>';
            } else {
                excelContainer.innerHTML = excelItems.map(item => createCheckItemHTML(item, savedChecks[item], false)).join('');
            }

            if (savedCustomItems.length === 0) {
                customContainer.innerHTML = '<div class="text-center text-gray-300 text-xs py-2">å°šæœªæ–°å¢é …ç›®</div>';
            } else {
                customContainer.innerHTML = savedCustomItems.map(item => createCheckItemHTML(item, savedChecks[item], true)).join('');
            }
        }

        function createCheckItemHTML(item, isChecked, isCustom) {
            const checkedClass = isChecked ? 'checked' : '';
            const deleteBtn = isCustom ? `<button onclick="deleteCustomItem('${item}')" class="ml-2 text-gray-300 hover:text-red-400 p-2"><i class="fas fa-times"></i></button>` : '';
            
            return `
                <div class="check-item ${checkedClass} flex items-center p-3 cursor-pointer hover:border-candy-mint shadow-sm mb-2">
                    <div class="flex-1 flex items-center" onclick="toggleCheck('${item}')">
                        <div class="mr-3 text-xl flex-shrink-0 transition-transform active:scale-90">
                            <i class="far fa-square text-gray-200 rounded-md"></i>
                            <i class="fas fa-check-square text-candy-mint text-xl shadow-green-100 drop-shadow-sm"></i>
                        </div>
                        <span class="font-bold text-gray-600 text-sm select-none">${item}</span>
                    </div>
                    ${deleteBtn}
                </div>
            `;
        }

        function toggleCheck(item) {
            const savedChecks = JSON.parse(localStorage.getItem('japanChecklist')) || {};
            savedChecks[item] = !savedChecks[item];
            localStorage.setItem('japanChecklist', JSON.stringify(savedChecks));
            
            const spans = document.querySelectorAll('.check-item span');
            spans.forEach(span => {
                if (span.textContent === item) {
                    const parent = span.closest('.check-item');
                    if(savedChecks[item]) parent.classList.add('checked');
                    else parent.classList.remove('checked');
                }
            });
        }

        function addCustomItem() {
            const input = document.getElementById('new-item-input');
            const val = input.value.trim();
            if (!val) return;

            const savedCustomItems = JSON.parse(localStorage.getItem('japanCustomItems')) || [];
            if (!savedCustomItems.includes(val)) {
                savedCustomItems.push(val);
                localStorage.setItem('japanCustomItems', JSON.stringify(savedCustomItems));
                location.reload(); 
            }
            input.value = '';
        }

        function deleteCustomItem(item) {
            if(!confirm(`ç¢ºå®šåˆªé™¤ã€Œ${item}ã€å—ï¼Ÿ`)) return;
            let savedCustomItems = JSON.parse(localStorage.getItem('japanCustomItems')) || [];
            savedCustomItems = savedCustomItems.filter(i => i !== item);
            localStorage.setItem('japanCustomItems', JSON.stringify(savedCustomItems));
            
            const savedChecks = JSON.parse(localStorage.getItem('japanChecklist')) || {};
            delete savedChecks[item];
            localStorage.setItem('japanChecklist', JSON.stringify(savedChecks));
            location.reload();
        }

        function resetChecklist() {
            if(confirm('é‡ç½®æ‰€æœ‰å‹¾é¸ç‹€æ…‹ï¼Ÿ')) {
                localStorage.removeItem('japanChecklist');
                location.reload();
            }
        }

        // ================= Finance (JPY logic) =================
        function updateExpensePreview() {
            const jpy = document.getElementById('cost').value;
            const rate = document.getElementById('rate-input').value || 4.6; // 1 TWD = 4.6 JPY
            const previewDiv = document.getElementById('expense-twd-preview');
            const previewAmount = document.getElementById('preview-amount');

            if (jpy && jpy > 0) {
                // TWD = JPY / Rate
                const twd = Math.round(jpy / rate);
                previewAmount.textContent = twd.toLocaleString();
                previewDiv.classList.remove('hidden');
            } else {
                previewDiv.classList.add('hidden');
            }
        }

        const form = document.getElementById('expense-form');
        const messageArea = document.getElementById('message-area');
        form.addEventListener('submit', e => {
            e.preventDefault();
            if (scriptURL === '' || scriptURL === 'YOUR_NEW_GOOGLE_SCRIPT_URL') { showMessage('è«‹è¨­å®š Script URL', 'error'); return; }
            
            const btn = form.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>'; btn.disabled = true;
            
            const currentRate = document.getElementById('rate-input').value || 4.6;
            const jpyCost = document.getElementById('cost').value;
            
            // [ä¿®æ”¹] åŠ å…¥ note æ¬„ä½
            const data = { 
                item: document.getElementById('item').value, 
                note: document.getElementById('note').value, // æ–°å¢é€™è¡Œï¼ŒæŠ“å–å‚™è¨»å…§å®¹
                cost: jpyCost, 
                costTwd: Math.round(jpyCost / currentRate), 
                rate: currentRate,
                payer: document.querySelector('input[name="payer"]:checked').value 
            };
            
            fetch(scriptURL, { method: 'POST', body: JSON.stringify(data), mode: 'no-cors', headers: { 'Content-Type': 'application/json' } })
            .then(() => { 
                showMessage('ğŸ‰ è¨˜å¸³æˆåŠŸï¼', 'success'); 
                form.reset(); 
                document.getElementById('expense-twd-preview').classList.add('hidden'); 
            })
            .catch(() => showMessage('ğŸ˜¥ éŒ¯èª¤', 'error'))
            .finally(() => { btn.innerHTML = originalText; btn.disabled = false; });
        });

        function showMessage(msg, type) { 
            messageArea.innerHTML = msg; 
            messageArea.className = `p-4 rounded-xl text-center text-sm font-bold transition-all shadow-sm border transform scale-100 ${type === 'success' ? 'bg-green-50 text-green-700 border-green-200' : 'bg-red-50 text-red-700 border-red-200'}`;
            messageArea.classList.remove('hidden');
            setTimeout(() => { messageArea.classList.add('hidden'); }, 3000); 
        }

        // ================= Exchange Rate (JPY) =================
        const jpInput = document.getElementById('jp-input'); 
        const twdInput = document.getElementById('twd-input'); 
        const rateInput = document.getElementById('rate-input');
        
        function calculateExchange() { 
            const rate = rateInput.value || 4.6; 
            if(jpInput.value) twdInput.value = Math.round(jpInput.value / rate).toLocaleString();
            else twdInput.value = '';
            updateExpensePreview(); // Update expense form preview if rate changes
        }
        
        jpInput.addEventListener('input', calculateExchange);
        rateInput.addEventListener('change', calculateExchange);
        
        function fetchLiveRate() {
            document.getElementById('rate-loading').classList.add('fa-spin');
            // Fetch TWD base, find JPY
            fetch('https://api.exchangerate-api.com/v4/latest/TWD').then(r => r.json()).then(d => { 
                if (d.rates.JPY) { 
                    rateInput.value = d.rates.JPY.toFixed(2); 
                    calculateExchange(); 
                    showMessage('åŒ¯ç‡æ›´æ–°', 'success'); 
                } 
            }).finally(() => document.getElementById('rate-loading').classList.remove('fa-spin'));
        }

        // ================= Weather (Tokyo: 35.6895, 139.6917) =================
        function fetchWeather() {
            const apiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=35.6895&longitude=139.6917&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo&forecast_days=5';
            fetch(apiUrl).then(r => r.json()).then(data => {
                for (let i = 0; i < 5; i++) {
                    const dayNum = i + 1;
                    const code = data.daily.weather_code[i];
                    const min = Math.round(data.daily.temperature_2m_min[i]);
                    const max = Math.round(data.daily.temperature_2m_max[i]);
                    
                    const iconEl = document.getElementById(`weather-icon-day${dayNum}`);
                    const textEl = document.getElementById(`weather-text-day${dayNum}`);
                    const adviceEl = document.getElementById(`weather-advice-day${dayNum}`);
                    
                    if(iconEl && textEl) {
                        iconEl.innerHTML = getWeatherIcon(code);
                        textEl.innerHTML = `${min}Â°C ~ ${max}Â°C | ${getWeatherDesc(code)}`;
                    }
                    if(adviceEl) {
                        adviceEl.innerText = getWeatherAdvice(code, min, max);
                    }
                }
            });
        }
        
        function getWeatherAdvice(code, min, max) {
            let advice = [];
            if ([51, 53, 55, 56, 57, 61, 63, 65, 66, 67, 80, 81, 82, 95, 96, 99].includes(code)) {
                advice.push("â˜” å¸¶å‚˜");
            } else if ([71, 73, 75, 77, 85, 86].includes(code)) {
                advice.push("â„ï¸ ä¸‹é›ªäº†");
            }
            if (max <= 8) {
                advice.push("ğŸ§£ ç©¿å¤§è¡£");
            } else if (max > 25) {
                advice.push("ğŸ§¢ æ³¨æ„é˜²æ›¬");
            }
            return advice.join(" | ");
        }

        function getWeatherIcon(code) {
            if (code === 0) return 'â˜€ï¸'; 
            if (code >= 1 && code <= 3) return 'â›…'; 
            if (code >= 51) return 'ğŸŒ§ï¸'; 
            if (code >= 71) return 'â„ï¸';
            return 'â˜ï¸';
        }
        function getWeatherDesc(code) {
            if (code === 0) return 'æ™´æœ—';
            if (code >= 1 && code <= 3) return 'å¤šé›²';
            if (code >= 71) return 'ä¸‹é›ª';
            if (code >= 51) return 'æœ‰é›¨';
            return 'é™°å¤©';
        }

        document.addEventListener('DOMContentLoaded', () => {
             fetchLiveRate();
             fetchWeather();
             fetchData(); 
        });
    </script>
</body>
</html>
